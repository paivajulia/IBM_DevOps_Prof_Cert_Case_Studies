#!/bin/bash

# create a datestamped filename for the raw wttr data:
today=$(TZ='America/Montreal'date +%Y%m%d)
weather_report=raw_data_$today

# download today's weather report from wttr.in:
city=Montreal
curl wttr.in/$city >> $weather_report

# use command substitution to store the current day, month, and year in corresponding shell variables:
day=$(TZ='America/Montreal' date -u +%d)
month=$(TZ='America/Montreal' date +%m)
year=$(TZ='America/Montreal' date +%Y)

# extract all lines containing temperatures from the weather report and write to file
grep Â°C $weather_report > temperatures.txt

# extract the current temperature

obs_tmp=$(cat temperatures.txt | awk -F ' Â°C' '{gsub(/.* /, "", $1); print $1}' | head -1)

echo "observed = $obs_tmp"

# extract the forecast for noon tomorrow
fc_temp=$( cat temperatures.txt | awk -F ' Â°C' '{gsub(/.* /, "", $2); print $2}'| head -2 | tail -1)
echo "fc temp = $fc_temp"

# create a tab-delimited record
record=$(echo -e "$year\t$month\t$day\t$obs_tmp\t$fc_temp")

# append the record to weather_poc.log
echo -e "$record" >> weather_poc.log
2023	10	27
2023	10	27	[38;5;154m18[0m	[38;5;154m18[0m
